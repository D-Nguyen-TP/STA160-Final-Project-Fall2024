---
title: "STA160 Final Project Code"
author: "Duy Nguyen"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(sf)
library(TTR)
#library(ggfortify)
library(forecast)
library(timetk)
```

```{r}
dat = read_csv("Sacramento Average Anomaly.csv")
```

```{r}
test = ts(dat$MAA, start = dat$Year[1], frequency = 1)
MA = SMA(dat$MAA, n = 15)
```
EDA Stuff
```{r}
ggplot(dat, mapping = aes(x = Year, y = MAA)) + 
  geom_line(color = "blue") + 
  geom_ribbon(aes(x = Year, y = MAA, ymin = dat$MAA - dat$Unc, ymax = dat$MAA + dat$Unc), alpha = 0.2) + 
  labs(title = "Sacramento Average Anomaly", x = "Years", y = "Average Anomaly") + 
  geom_line(aes(y = MA), color = "red")
```

```{r}
ggplot(dat, aes(x = Year, y = Unc)) + geom_line() + labs(title = "Uncertainty levels of Sacramento Average Anomaly")
```

```{r}
series = ts(dat$MAA, start = dat$Year[1])

autoplot(SMA(series, n = 15))
```

```{r}
full_raw = read_csv("Sacramento Data Anomaly FULL.csv")
```

```{r}
full = ts(full_raw$Anomaly, frequency = 12)
```

```{r}
full %>% decompose() %>% autoplot() + 
  labs(title = "Decomposed Sacramento Time Series")
```

## Splitting the Data

```{r}
first = full = ts(full_raw$Anomaly[1:120], frequency = 12)
last = full = ts(full_raw$Anomaly[1944:2064], frequency = 12)

first %>% decompose() %>% autoplot()
last %>% decompose() %>% autoplot()
```

```{r}
# 5 folds cross validaation setup
splits = list(c(1:34), c(35:69), c(70:104), c(105:139), c(140:172))
dat[splits[[1]], ]
```

